<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Linux内核参数 # 通过以下方式，修改内核参数 # 临时修改内核参数 # sysctl -w kernel.parameter=&#34;[$Example]&#34; $ sysctl -w net.ipv4.ip_local_port_range=&#34;10000 65535&#34; $ sysctl -w vm.max_map_count=262144 $ sysctl -w net.ipv4.ip_forward=1 # 修改/proc/sys目录下文件 $ echo 1 &gt; /proc/sys/net/ipv4/ip_forward 通过修改配置文件的方式永久修改内核参数 # 执行以下命令，修改/etc/sysctl.conf文件中的参数 $ vi /etc/sysctl.conf # 执行以下命令，使配置生效 # -p 从指定的文件加载系统参数，如不指定即从/etc/sysctl.conf中加载 $ sysctl -p # sysctl.d目录下配置文件 $ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.ipv4.ip_forward = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 fs.inotify.max_user_watches = 524288 fs.inotify.max_user_instances = 16384 vm.max_map_count = 262144 net.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="Linux内核参数 # 通过以下方式，修改内核参数 # 临时修改内核参数 # sysctl -w kernel.parameter=&#34;[$Example]&#34; $ sysctl -w net.ipv4.ip_local_port_range=&#34;10000 65535&#34; $ sysctl -w vm.max_map_count=262144 $ sysctl -w net.ipv4.ip_forward=1 # 修改/proc/sys目录下文件 $ echo 1 &gt; /proc/sys/net/ipv4/ip_forward 通过修改配置文件的方式永久修改内核参数 # 执行以下命令，修改/etc/sysctl.conf文件中的参数 $ vi /etc/sysctl.conf # 执行以下命令，使配置生效 # -p 从指定的文件加载系统参数，如不指定即从/etc/sysctl.conf中加载 $ sysctl -p # sysctl.d目录下配置文件 $ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.ipv4.ip_forward = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 fs.inotify.max_user_watches = 524288 fs.inotify.max_user_instances = 16384 vm.max_map_count = 262144 net." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/linux/sysctl/" /><meta property="article:section" content="linux" />



<title>Sysctl | 文档目录</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.b506b3c0a3a8d01f285619b34991da0217fa146cdf2d7f5d7ef92416a1b0702d.js" integrity="sha256-tQazwKOo0B8oVhmzSZHaAhf6FGzfLX9dfvkkFqGwcC0=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>文档目录</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  <ul>
<li><strong>Linux</strong></li>
<li><a href="/linux/sysctl/"class=active>Linux内核参数</a></li>
<li><a href="/linux/centos-wifi/">centos连接wifi无线网</a></li>
<li><a href="/linux/staticip/">静态IP设置</a>
<br /></li>
</ul>










</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Sysctl</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#linux内核参数">Linux内核参数</a>
      <ul>
        <li><a href="#通过以下方式修改内核参数">通过以下方式，修改内核参数</a></li>
        <li><a href="#sysctl常用命令">sysctl常用命令</a></li>
        <li><a href="#procsys">/proc/sys</a></li>
        <li><a href="#内核参数说明">内核参数说明</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="linux内核参数">
  Linux内核参数
  <a class="anchor" href="#linux%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0">#</a>
</h1>
<h2 id="通过以下方式修改内核参数">
  通过以下方式，修改内核参数
  <a class="anchor" href="#%e9%80%9a%e8%bf%87%e4%bb%a5%e4%b8%8b%e6%96%b9%e5%bc%8f%e4%bf%ae%e6%94%b9%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0">#</a>
</h2>
<ol>
<li>临时修改内核参数</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># sysctl -w kernel.parameter=&#34;[$Example]&#34;</span>
</span></span><span style="display:flex;"><span>$ sysctl -w net.ipv4.ip_local_port_range<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;10000 65535&#34;</span>
</span></span><span style="display:flex;"><span>$ sysctl -w vm.max_map_count<span style="color:#f92672">=</span><span style="color:#ae81ff">262144</span>
</span></span><span style="display:flex;"><span>$ sysctl -w net.ipv4.ip_forward<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 修改/proc/sys目录下文件</span>
</span></span><span style="display:flex;"><span>$ echo <span style="color:#ae81ff">1</span> &gt; /proc/sys/net/ipv4/ip_forward
</span></span></code></pre></div><ol start="2">
<li>通过修改配置文件的方式永久修改内核参数</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 执行以下命令，修改/etc/sysctl.conf文件中的参数</span>
</span></span><span style="display:flex;"><span>$ vi /etc/sysctl.conf 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行以下命令，使配置生效</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -p 从指定的文件加载系统参数，如不指定即从/etc/sysctl.conf中加载</span>
</span></span><span style="display:flex;"><span>$ sysctl -p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sysctl.d目录下配置文件</span>
</span></span><span style="display:flex;"><span>$ cat <span style="color:#e6db74">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.ipv4.ip_forward = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fs.inotify.max_user_watches = 524288
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fs.inotify.max_user_instances = 16384
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">vm.max_map_count = 262144
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">net.core.somaxconn = 65535
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>$ sysctl -p /etc/sysctl.d/k8s.conf
</span></span></code></pre></div><h2 id="sysctl常用命令">
  sysctl常用命令
  <a class="anchor" href="#sysctl%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 查看所有内存参数</span>
</span></span><span style="display:flex;"><span>$ sysctl –a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看某个内核参数</span>
</span></span><span style="display:flex;"><span>$ sysctl net.ipv4.ip_forward
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 临时修改某个内核参数</span>
</span></span><span style="display:flex;"><span>$ sysctl -w net.ipv4.ip_forward<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><h2 id="procsys">
  /proc/sys
  <a class="anchor" href="#procsys">#</a>
</h2>
<p>/proc/sys下内核文件与配置文件sysctl.conf中变量的对应关系：</p>
<p>将/proc/sys中的文件转换成sysctl中的变量依据下面两个简单的规则：</p>
<ol>
<li>去掉前面部分/proc/sys</li>
<li>将文件名中的斜杠变为点</li>
</ol>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/proc/sys/net/ipv4/ip_forward -&gt; net.ipv4.ip_forward
</span></span><span style="display:flex;"><span>/proc/sys/kernel/hostname -&gt; kernel.hostname
</span></span></code></pre></div><h2 id="内核参数说明">
  内核参数说明
  <a class="anchor" href="#%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0%e8%af%b4%e6%98%8e">#</a>
</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>默认值</th>
<th>建议值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>fs.file-max</td>
<td>1516209</td>
<td>-</td>
<td>系统允许的文件句柄的最大数目（也就是能打开文件的最大数量），因为连接需要占用文件句柄。注意：/etc/security/limits.conf文件内对nofile的配置（使用ulimit -n查看），还有/etc/security/limits.d/20-nproc.conf文件内对nproc的配置（使用ulimit -u查看），最好配置万这两个参数重启下系统。</td>
</tr>
<tr>
<td>net.ipv4.tcp_synack_retries</td>
<td>5</td>
<td>0</td>
<td>表示回应第二个握手包（SYN+ACK包）给客户端IP后，如果收不到第三次握手包（ACK包），进行重试的次数（默认为5）。修改这个参数为0，可以加快回收半连接，减少资源消耗，但是有一个副作用：网络状况很差时，如果对方没收到第二个握手包，可能连接服务器失败，但对于一般网站，用户刷新一次页面即可。根据抓包经验，这种情况很少，但为了保险起见，可以只在被tcp洪水攻击时临时启用这个参数。之所以可以把tcp_synack_retries改为0，因为客户端还有tcp_syn_retries参数，即使服务器端没有重发SYN+ACK包，客户端也会重发SYN握手包。</td>
</tr>
<tr>
<td>net.ipv4.tcp_syn_retries</td>
<td>6</td>
<td>1</td>
<td>表示当没有收到服务器端的SYN+ACK包时，客户端重发SYN握手包的次数。</td>
</tr>
<tr>
<td>net.ipv4.tcp_max_syn_backlog</td>
<td>1024</td>
<td>20480</td>
<td>半连接队列长度（默认为1024），加大SYN队列长度可以容纳更多等待连接的网络连接数，具体多少数值受限于内存。</td>
</tr>
<tr>
<td>fs.inotify.max_user_instances</td>
<td>128</td>
<td>16384</td>
<td>表示每一个real user ID可创建的inotify instatnces的数量上限，默认128。</td>
</tr>
<tr>
<td>fs.inotify.max_user_watches</td>
<td>8192</td>
<td>524288</td>
<td>表示同一用户同时可以添加的watch数目（watch一般是针对目录，决定了同时同一用户可以监控的目录数量）。</td>
</tr>
<tr>
<td>net.core.somaxconn</td>
<td>128</td>
<td>65535</td>
<td>socket监听（listen）的backlog上限</td>
</tr>
</tbody>
</table>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#linux内核参数">Linux内核参数</a>
      <ul>
        <li><a href="#通过以下方式修改内核参数">通过以下方式，修改内核参数</a></li>
        <li><a href="#sysctl常用命令">sysctl常用命令</a></li>
        <li><a href="#procsys">/proc/sys</a></li>
        <li><a href="#内核参数说明">内核参数说明</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












